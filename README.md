FILLER CONTENT GENERATED BY CHATGPT:

# 🏀 Fantasy Basketball Project — Scraper → Clean DB → Modeling

This repo scrapes Basketball-Reference, cleans the results, and builds a modeling-ready SQLite database for analysis (fantasy scoring, projections, player comps, team modeling, etc.). Folder layout and filenames here match what’s already in your repo. ([GitHub][1])

---

## ✨ What this repo does

* **Scrape & parse** BBR pages with robust selectors and guards against layout shifts.
* **Throttle & retry** to avoid 429s; includes a sandbox for IP-friendly testing.
* **Normalize & load** into **SQLite** with stable keys for players/games/box scores.
* **Model playground** with notebooks and utilities to generate rolling/per-36 features.

---

## 📁 Project structure

```
.
├─ data_testing/               # Ad-hoc data checks / parsing experiments
├─ database_testing/           # Local DB schema/tests, quick sanity queries
├─ model_testing/              # Notebooks / scripts for baseline models & EDA
├─ try_not_to_get_ip_banned/   # Rate-limit, retry/backoff experiments
├─ scrape_functions.py         # HTML fetch/parse utilities for BBR
├─ database_conn.py            # SQLite helpers (connect, create, upsert)
├─ old_functions.py            # Legacy code kept for reference
└─ .vscode/                    # Editor settings
```

*(Names pulled from the current repo listing.)* ([GitHub][1])

---

## 🔧 Requirements

* Python 3.10+
* Recommended packages (pin these in `requirements.txt`):

  ```
  requests
  beautifulsoup4
  lxml
  pandas
  python-dateutil
  tqdm
  sqlite-utils
  ```
* SQLite (bundled with Python)

---

## 🚀 Quickstart

1. **Create & activate a venv**

```bash
python -m venv .venv
source .venv/bin/activate        # Windows: .venv\Scripts\activate
```

2. **Install deps**

```bash
pip install -r requirements.txt  # or pip install requests beautifulsoup4 lxml pandas tqdm sqlite-utils
```

3. **Configure (optional)**

* Default DB path: `./nba.db` (or use `database_testing/nba.db`)
* Create a `.env` or pass CLI flags if you wire them up (examples below).

4. **Scrape a season**

```bash
python -c "import scrape_functions as s; s.scrape_season(2024, include_playoffs=True, rate_limit=1.5)"
```

5. **Build features / export**

```python
# In a notebook or script
import sqlite3, pandas as pd
conn = sqlite3.connect("nba.db")
df = pd.read_sql_query("SELECT * FROM vw_player_game_features", conn)
df.to_parquet("exports/player_game_features.parquet", index=False)
```

> If your `scrape_functions.py` exposes different entry points (e.g., `scrape_players`, `scrape_games`, `scrape_boxscores`), call those individually, then run a `build_features()` step. Keep the README aligned with whatever function names you export.

---

## 🗄️ Database design (suggested / typical for this repo)

**players**
`player_id` (PK), `bbref_id` (slug, UNIQUE), `full_name`, `pos_primary`, `height`, `weight`, `birth_date`, …

**teams**
`team_id` (PK), `abbrev` (UNIQUE), `name`, `conference`, `division`

**games**
`game_id` (PK, e.g., `YYYY-MM-DD-AWAY-HOME`), `date`, `season`, `home_team`, `away_team`, `home_pts`, `away_pts`, `is_playoffs`

**boxscores**
Composite PK: (`game_id`,`player_id`). Standard per-game counting stats: `mp, fg, fga, fg3, fg3a, ft, fta, orb, drb, trb, ast, stl, blk, tov, pf, pts, plus_minus`

**Views (model-ready)**

* `vw_boxscores_per36`: per-36 conversions
* `vw_player_game_features`: rolling L5/L10 features, rest-days, home/away, opponent flags

---

## 🧰 Using `database_conn.py`

Typical helpers to include/use:

```python
from database_conn import SQLiteClient

with SQLiteClient("nba.db") as db:
    db.create_tables_if_not_exists()
    db.upsert("players", player_rows, unique_cols=["bbref_id"])
    db.upsert("games", game_rows, unique_cols=["game_id"])
    db.upsert("boxscores", boxscore_rows, unique_cols=["game_id","player_id"])
```

> If your actual API differs, mirror it here so users know the canonical way to connect, create tables, and upsert rows.

---

## 🧪 Modeling starters (examples)

**Baseline fantasy score (customize weights):**

```sql
SELECT
  b.game_id, p.full_name,
  b.trb + b.ast + 0.5*b.pts - 1.0*b.tov
  + (CASE WHEN ( (b.pts>=10)+(b.trb>=10)+(b.ast>=10)+(b.stl>=10)+(b.blk>=10) )>=2 THEN 1 ELSE 0 END)
  + (CASE WHEN ( (b.pts>=10)+(b.trb>=10)+(b.ast>=10)+(b.stl>=10)+(b.blk>=10) )>=3 THEN 2 ELSE 0 END)
    AS fantasy_score
FROM boxscores b
JOIN players p USING(player_id);
```

**KNN baseline flow:**

1. Pull features from `vw_player_game_features`.
2. Train/test split by date.
3. Standardize features, fit `KNeighborsRegressor`.
4. Evaluate MAE/RMSE; iterate on features (pace, opponent def splits, rest, etc.).

---

## 🕸️ Scraping notes

* Prefer CSS selectors like:

  ```python
  soup.select('table#per_game_stats[data-stat="per_game"]')
  ```
* Combine attributes with **no commas** (e.g., `tag[attr="x"][data-y="z"]`), not `tag[attr="x", data-y="z"]`.
* Implement **rate limiting & backoff** (see `try_not_to_get_ip_banned/`) to avoid 429s and be a good citizen.
* Cache raw HTML to a local folder to reduce load during dev.

---

## ⚠️ Respect terms & robots

* Review **Basketball-Reference** robots.txt/ToS and scrape responsibly.
* Educational/research use; do not overload the site.

---

## 🧹 Troubleshooting

* **429 Too Many Requests** → increase sleep, add jitter, resume later; verify cache use.
* **DB locked on Windows** → close VS Code SQLite viewers before writes.
* **Selector breakage** → inspect page, update `scrape_functions.py` CSS selectors.
* **Unexpected nulls** → coerce types explicitly; normalize “DNP”/“Did Not Play” rows.

---

## 🗺️ Roadmap (nice-to-haves)

* Play-by-play ingestion for pace/possessions
* Injury tagging & minutes baselines
* Automated feature store snapshots by date
* Evaluation harness for multiple fantasy point schemas

---

## 🤝 Contributing

PRs welcome. Please:

* Add docstrings & type hints
* Keep functions pure/testable; avoid global state
* Include a minimal repro or unit test for scraper changes

---

## 📜 License

MIT for code. Data belongs to their respective owners.

---

### Maintainer

* **Derrick Dollesin** — see repo profile for contact/GitHub.

---
